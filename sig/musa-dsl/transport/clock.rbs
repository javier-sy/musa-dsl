# RBS for transport/clock.rb - Clock and timing infrastructure

module Musa
  module Clock
    # Abstract base class for all clock implementations.
    class Clock
      def initialize: () -> void

      # Checks if the clock is currently running.
      def running?: () -> bool

      # Registers a callback to be called when the clock starts.
      def on_start: () { () -> void } -> void

      # Registers a callback to be called when the clock stops.
      def on_stop: () { () -> void } -> void

      # Registers a callback to be called when playback position changes.
      def on_change_position: () { (bars: Rational?, beats: Rational?, midi_beats: Integer?) -> void } -> void

      # Starts the clock running and generates ticks.
      def run: () { () -> void } -> void

      # Stops the clock and terminates the run loop.
      def terminate: () -> void
    end

    # Internal high-precision timer-based clock.
    class TimerClock < Clock
      def initialize: (?bpm: Numeric?, ?ticks_per_beat: Integer?) -> void

      # Current BPM.
      attr_reader bpm: Numeric

      # Sets BPM.
      def bpm=: (Numeric bpm) -> Numeric

      # Starts the timer clock.
      def start: () -> void
    end

    # Synchronized to external MIDI Clock messages.
    class InputMidiClock < Clock
      def initialize: (untyped midi_input) -> void
    end

    # Manually triggered ticks (for testing/integration).
    class ExternalTickClock < Clock
      # Generates a single tick.
      def tick: () -> void
    end

    # Simplified clock for testing.
    class DummyClock < Clock
      def initialize: (?Integer? ticks, ?condition: Proc?) -> void
    end
  end
end
