# RBS for repl/repl.rb - TCP-based REPL server for live coding

module Musa
  module REPL
    # TCP-based REPL server for live coding.
    class REPL
      # Creates a new REPL server.
      #
      # @param bind Execution context (Binding or DynamicProxy).
      # @param port TCP port to listen on (default: 1327).
      # @param after_eval Callback invoked after successful code execution.
      # @param logger Logger instance.
      # @param highlight_exception Enable ANSI color in exception output.
      def initialize: (
        ?(Binding | untyped)? bind,
        ?port: Integer?,
        ?after_eval: (^(String) -> void)?,
        ?logger: Logger::Logger?,
        ?highlight_exception: bool?
      ) -> void

      # Sets or updates the binding context.
      def bind=: (Binding | untyped bind) -> (Binding | untyped)

      # Stops the REPL server and cleans up all threads.
      def stop: () -> void

      # Sends messages to the connected REPL client.
      def puts: (*untyped messages) -> nil
    end

    # Mixin for DSL contexts that can be bound to a REPL.
    module CustomizableDSLContext
      # Returns the binding for code execution.
      def binder: () -> Binding

      # Executes source code in the DSL context.
      def execute: (String source_block, String file, Integer line) -> untyped
    end
  end
end
