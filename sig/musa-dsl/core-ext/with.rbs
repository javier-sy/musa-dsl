# RBS for core-ext/with.rb - DSL context switching module

module Musa
  module Extension
    # Module providing the `with` method for flexible DSL block execution.
    #
    # The `with` method is a cornerstone of Musa DSL's builder pattern, allowing
    # objects to execute blocks in either the object's context (for DSL-style
    # configuration) or the caller's context (for traditional Ruby blocks).
    module With
      # Executes a block with flexible context and parameter handling.
      #
      # @param value_parameters Positional parameters to pass to block
      # @param keep_block_context Explicit control of context switching
      # @param key_parameters Keyword parameters to pass to block
      # @param block Block to execute
      # @return Result of block execution
      def with: (*untyped value_parameters, ?keep_block_context: bool?, **untyped key_parameters) ?{ (*untyped) -> untyped } -> untyped
    end

    # Smart proc binder for parameter introspection
    module SmartProcBinder
      class SmartProcBinder
        # Creates new SmartProcBinder wrapping a proc
        def initialize: (Proc proc) -> void

        # Returns proc's parameter definitions
        def parameters: () -> Array[[Symbol, Symbol]]

        # Returns the wrapped proc
        def proc: () -> Proc

        # Applies parameters to proc
        def _apply: (Array[untyped] value_parameters, Hash[Symbol, untyped] key_parameters) -> [Array[untyped], Hash[Symbol, untyped]]

        # Calls the proc with parameters
        def call: (*untyped, **untyped) -> untyped
      end
    end
  end
end
