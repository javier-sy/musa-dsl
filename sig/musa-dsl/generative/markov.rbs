# RBS for generative/markov.rb - Markov chain generator

module Musa
  module Markov
    # Markov chain serie generator.
    #
    # Generates sequences of states following probabilistic transition rules.
    # Implements Serie interface for integration with series operations.
    class Markov
      include Series::Serie::SerieImplementation

      # Transition type: Array for equal probability
      type transition_array = Array[untyped]

      # Transition type: Hash for weighted probability
      type transition_hash = Hash[untyped, Numeric]

      # Transition type: Proc for algorithmic transitions
      type transition_proc = ^(Array[untyped] history) -> untyped

      # Transition value can be Array, Hash, or Proc
      type transition_value = transition_array | transition_hash | transition_proc

      # Transitions hash maps states to transition definitions
      type transitions_hash = Hash[untyped, transition_value]

      # Creates Markov chain generator.
      #
      # @param transitions State transition rules
      # @param start Initial state
      # @param finish Terminal state (nil for infinite)
      # @param random Random number generator or seed
      def initialize: (
        transitions: transitions_hash,
        start: untyped,
        ?finish: untyped?,
        ?random: (Random | Integer)?
      ) -> void

      # Starting state
      attr_accessor start: untyped

      # Finishing state (nil for infinite)
      attr_accessor finish: untyped?

      # Random number generator
      attr_accessor random: Random

      # Transition rules (frozen)
      attr_accessor transitions: transitions_hash

      # Checks if Markov chain is infinite.
      def infinite?: () -> bool
    end
  end
end
